# Causality05-StructuralCausalModel
虽然前面我们使用因果图模型来编码我们提出的因果假设，但事实上我们还是没解释清楚究竟什么是干预，什么是因果机制。这一节我们将介绍结构因果模型，用来解答这些问题。

## 1. Structural Equations
当我们在谈论因果性的时候，其中一定存在着非对称性，比如A导致了B，但是B就不会导致A，这时候我们应该如何来表示这样的因果关系呢？
我们平时使用的等号其实并不包含因果性，因为A=B和B=A是等价的，因此等号具有对称性，而因果性是不对称的，所以我们不能直接用等号来表示因果关系。这时候结构方程structural equation就被提出了，A是B的cause可以表示为：

$$
B:= f(A)
$$

其中$f$是某种函数，可以将变量A映射到变量B上。我们用$:=$来表示因果关系，这是我们从统计模型拓展到到因果模型的重要一步。函数$f$是确定性的，在理想情况下，我们希望它是概率性的，因为这样可以给一些未知因素留下空间，我们将这些**未知因素用U来表示**，这样就有：

$$
B:=f(A, U)
$$

我们之前一直研究如何计算$Y_i(t)$，对应到上面这个结构方程中，B就是Y，A就是T，而U则是像下标i一类的无关紧要的变量，这些变量也被称为background condition，他们是在我们采样的过程中才能得到的。
通过结构方程，我们可以更好地定义前面提出的因果机制这个概念。所谓的因果机制就是这些函数$f$，而A被称为B的直接原因(direct cause)，因为A直接出现在了B的结构方程中，而不是直接原因的那些就被称为cause
更进一步，我们可以把因果图中的变量分为两类，分别是：
- 内生变量(endogenous)，指的是我们需要建模其因果机制的那些变量(其实有parents的那些变量)，也就是有结构方程的那些变量，在下面这个例子中，BCD都是内生变量
- 外源变量(exogenous)，就是在因果图中没有任何parents的节点，在下面这个例子中，A和$U_B,U_C,U_D$都是外源变量
![](resources/Pasted%20image%2020230211214549.png)
在此基础上，一个结构因果模型可以被定义为包含下面这些集合的元组：
1. 一个内生节点集合V
2. 一个外源节点集合U
3. 一个函数集合f，每一个函数可以用给定的变量输入来生成对应的内生变量
如果因果图不包含环（是一个DAG），并且噪声变量U是独立的，那么因果模型是马尔可夫的(Markovian)；节点的联合分布P相对于因果图是马尔可夫的。如果因果图不包含环，但噪声是独立的，那么该模型是半马尔科夫的。而有环的因果图则是非马尔可夫的。


## 2. Interventions
在SCM中，因果干预也变得非常简单，具体来说，如果我们要$do(T=t)$，那么只要把T的结构方程修改成$T := t$就行，这其实和前面说的移除所有干预节点的parents指向的边是一致的。能这么多还是因为我们有模块化假设：
> (Modularity Assumption for SCMs)考虑一个因果结构模型$M$和一个干预后($do(T=t)$)的因果模型$M_t$，模块性假设认为$M, M_t$共享所有除T之外的结构方程。

换句话说，这样的干预实际上是对T的局部操作，其他的结构方程均不会发生改变。我们用$Y_t(u)$来表示单元u(就是和第i条数据同个意思)在$T=t$时候的潜在结果(此时的SCM是M)。另一方面我们用$Y_{M_t}(u)$表示u在干预后的SCM $M_t$中观测到的潜在结果，而模块性假设意在说明，这两者是相等的。这也被叫做反事实定律(The Law of Counterfactuals)，因此给定足够详细的SCM，我们是可以计算因果干预之后的反事实结果的。


## 3. Collider Bias
在后门准则中，我们不仅定义了W阻断了所有后门路径，而且要求W不包含任何T的后代，这是为什么呢？这是因为，如果W中包含了T的后代，可能会出现这样两种情况：
1. 我们阻断了T流向Y的因果关系
2. 我们在T和Y之间引入了非因果关联
我们可以通过几个例子来看。比如下面这个图，M是T和Y之间的一个mediator，如果我们将M也作为block的一部分给block了，那么就会导致T和Y之间所有的关联全断了，后续的研究也就无法进行下去。
![](resources/Pasted%20image%2020230214115419.png)

在下面这个SCM中，虽然T到Y还有别的路径，但是如果把M阻断了，因果关系的传递还是会有一部分被干扰，所以也不能这么做。
![](resources/Pasted%20image%2020230214115925.png)

如果这个M不在T到Y的有向路径上(也就是说不是mediator)，但是依然是T的后代，那我们一旦对Z进行了conditioning，会导致T的分布发生改变，从而带来因果效应估计中的bias，这时候的Z实际上是一个前文提到过的collider结构，所以这种情况也被称为collider bias
![](resources/Pasted%20image%2020230214120912.png)

## 4. Limits of SCM
结构化因果模型和do算子的局限性在于，它们依赖于数据的独立同分布(i.i.d)，也就是说，所有观测到的数据实际上都是通过同一个SCM生成的，这使得直接使用do算子来定义反事实(Counterfactual)会存在一些问题。
> 所谓的反事实，是因果推断中一个非常常见的概念，它是定义在**数据个体层面**上的，Pearl教授的书中采用了$P(Y_{X=x}=y\mid Y=y', X=x')$来表示反事实，这个概率表达式的意思其实是在观察到一个单位的取值是$Y=y', X=x'$时，这个单位的取值是$Y=y, X=x$的概率。

我们可以发现，do算子是针对SCM定义的，而SCM是给**全体数据或者某个sub group定义**的，从这个角度上来讲，反事实将造成这个单位的因果图和其他数据单位不一致的问题，这其实就是SCM自身存在的局限性。